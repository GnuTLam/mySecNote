## What is DOM ?
DOM (Document Object Model) l√† c·∫•u tr√∫c ph√¢n c·∫•p c·ªßa trang web m√† tr√¨nh duy·ªát x√¢y d·ª±ng, th·ªÉ hi·ªán d∆∞·ªõi d·∫°ng c√¢y c√°c n√∫t (nodes) v√† ƒë·ªëi t∆∞·ª£ng (objects) t∆∞∆°ng ·ª©ng v·ªõi c√°c th·∫ª HTML, thu·ªôc t√≠nh v√† n·ªôi dung
## Taint Flow
### Source
``` Common_source
document.URL 
document.documentURI 
document.URLUnencoded 
document.baseURI 
location 
document.cookie 
document.referrer 
window.name 
history.pushState 
history.replaceState 
localStorage 
sessionStorage 
IndexedDB (mozIndexedDB, webkitIndexedDB, msIndexedDB) 
Database
```
### Sink
```
DOM XSS document.write()  
Open redirection  window.location  
Cookie manipulation  document.cookie  
JavaScript injection eval()  
Document-domain manipulation document.domain  
WebSocket-URL poisoning WebSocket()  
Link manipulation element.src  
Web message manipulation postMessage()  
Ajax request-header manipulation setRequestHeader()  
Local file-path manipulation FileReader.readAsText()  
Client-side SQL injection ExecuteSql()  
HTML5-storage manipulation sessionStorage.setItem()  
Client-side XPath injection document.evaluate()  
Client-side JSON injection JSON.parse()  
DOM-data manipulation element.setAttribute()  
Denial of service RegExp()
```

## DOM clobbering
#TODO: Update later
[An Art of Dom Clobbering - From Zero to Advance Level - HACKLIDO](https://hacklido.com/blog/43-an-art-of-dom-clobbering-from-zero-to-advance-level)
[DOM Clobbering](https://domclob.xyz/domc_markups/list)
## DOM-based vulnerabilities
###  DOM-based open redirection
**[URL validation bypass cheat sheet](https://portswigger.net/web-security/ssrf/url-validation-bypass-cheat-sheet)**
M·ªôt s·ªë sink trong tr∆∞·ªùng h·ª£p n√†y
``` SINK
location 
location.host 
location.hostname 
location.href 
location.pathname 
location.search 
location.protocol 
location.assign() 
location.replace() 
open() 
element.srcdoc 
XMLHttpRequest.open() 
XMLHttpRequest.send() 
jQuery.ajax() 
$.ajax()
```

### Cookie manipulation
M·ªôt s·ªë trang web cho ph√©p JavaScript **ghi d·ªØ li·ªáu t·ª´ ngu·ªìn kh√¥ng ƒë√°ng tin** (nh∆∞ `location.hash`) v√†o `document.cookie`. ƒêi·ªÅu n√†y c√≥ th·ªÉ **b·ªã k·∫ª t·∫•n c√¥ng l·ª£i d·ª•ng ƒë·ªÉ √©p ng∆∞·ªùi d√πng l∆∞u cookie t√πy √Ω**, m√† sau ƒë√≥ c√≥ th·ªÉ ƒë∆∞·ª£c trang web s·ª≠ d·ª•ng **m·ªôt c√°ch kh√¥ng an to√†n**, d·∫´n ƒë·∫øn **XSS**, **session fixation**, ho·∫∑c (exploit chain)**.
###### üß® Tr∆∞·ªùng h·ª£p 1: Cookie ƒëi·ªÅu khi·ªÉn h√†nh vi tr√™n website
V√≠ d·ª•:
- Cookie c√≥ t√™n `mode=demo` ho·∫∑c `mode=prod`
- D·ª±a v√†o cookie n√†y, trang web hi·ªÉn th·ªã n·ªôi dung kh√°c nhau
‚Üí Khi attacker c√≥ th·ªÉ √©p n·∫°n nh√¢n l∆∞u cookie t√πy √Ω, h·ªç c√≥ th·ªÉ **thay ƒë·ªïi h√†nh vi c·ªßa trang**, khi·∫øn ng∆∞·ªùi d√πng:
- truy c·∫≠p sai ch·ª©c nƒÉng,
- bypass ƒë∆∞·ª£c gi·ªõi h·∫°n UI,
- b·ªã l·ª´a th·ª±c hi·ªán h√†nh ƒë·ªông kh√¥ng mong mu·ªën (UX manipulation)
##### üß® Tr∆∞·ªùng h·ª£p 2: Cookie ch·ª©a **token phi√™n (session ID)**
- Website d√πng cookie nh∆∞ `sessionId=xyz123` ƒë·ªÉ x√°c th·ª±c ng∆∞·ªùi d√πng
- N·∫øu attacker √©p n·∫°n nh√¢n d√πng session ID do h·∫Øn c·∫•p ‚Üí g·ªçi l√† **Session Fixation**
**M·ª•c ti√™u**: Chi·∫øm quy·ªÅn truy c·∫≠p sau khi ng∆∞·ªùi d√πng ƒëƒÉng nh·∫≠p
**Quy tr√¨nh session fixation:**
1. Attacker c√≥ s·∫µn token h·ª£p l·ªá: `sessionId=attackerToken`
2. G·ª≠i link d·∫°ng:
	`https://victim.com/page#sessionId=attackerToken`
3. Trang c√≥ JS nh∆∞:
    `document.cookie = 'sessionId=' + location.hash.slice(1);`
4. Ng∆∞·ªùi d√πng b·ªã √©p d√πng session ID c·ªßa attacker
5. Khi user ƒëƒÉng nh·∫≠p ‚Üí session thu·ªôc attacker